-- ============================================
-- เพิ่ม columns สำหรับระบบยกยอดวันลาพักผ่อน
-- ตามระเบียบสำนักนายกรัฐมนตรี พ.ศ. 2555
-- ============================================

-- 1. เพิ่ม hire_date - วันเริ่มรับราชการ (เพื่อคำนวณอายุราชการ)
ALTER TABLE users ADD COLUMN IF NOT EXISTS hire_date DATE;

-- 2. เพิ่ม vacation_carryover - วันลาพักผ่อนสะสมจากปีก่อน
-- หมายเหตุ: vacation_leave_balance คือวันลาปีปัจจุบัน (10 วัน)
-- vacation_carryover คือวันลาที่ยกยอดจากปีที่แล้ว
ALTER TABLE users ADD COLUMN IF NOT EXISTS vacation_carryover INTEGER DEFAULT 0;

-- 3. เพิ่ม last_carryover_fiscal_year - ปีงบประมาณล่าสุดที่ยกยอด (ป้องกัน double carryover)
-- ปีงบประมาณไทยเริ่ม 1 ตุลาคม เช่น 2568 = 1 ต.ค. 2567 - 30 ก.ย. 2568
ALTER TABLE users ADD COLUMN IF NOT EXISTS last_carryover_fiscal_year INTEGER;

-- 4. เพิ่ม comment อธิบาย
COMMENT ON COLUMN users.hire_date IS 'วันเริ่มรับราชการ - ใช้คำนวณอายุราชการและเพดานสะสมวันลาพักผ่อน';
COMMENT ON COLUMN users.vacation_carryover IS 'วันลาพักผ่อนสะสมจากปีก่อน (อายุราชการ<10ปี สะสมได้สูงสุด20วัน, >=10ปี สะสมได้30วัน)';
COMMENT ON COLUMN users.last_carryover_fiscal_year IS 'ปีงบประมาณล่าสุดที่ทำการยกยอดแล้ว ป้องกันยกยอดซ้ำ';

-- ============================================
-- กฎเกณฑ์การสะสมวันลาพักผ่อน
-- ============================================
-- 1. พนักงานใหม่ปีแรก: ได้รับ 10 วัน (ไม่มียกยอด)
-- 2. ปีต่อมา: 10 วัน + ยกยอดจากปีก่อน
-- 3. เพดานสะสม:
--    - อายุราชการ < 10 ปี: สะสมได้สูงสุด 20 วัน (รวมปีนี้)
--    - อายุราชการ >= 10 ปี: สะสมได้สูงสุด 30 วัน (รวมปีนี้)
-- 4. ปีงบประมาณเริ่ม 1 ตุลาคม
-- ============================================

-- ตัวอย่างการคำนวณ:
-- น.ส.กรรณิการ์ อายุราชการ 5 ปี
-- - ปี 67: vacation_leave_balance = 10, ใช้ 6 วัน -> คงเหลือ 4 วัน
-- - ปี 68: ยกยอด 4 วัน, ได้ใหม่ 10 วัน = 14 วัน (ไม่เกิน 20)
-- - vacation_carryover = 4, vacation_leave_balance = 10
-- - รวมใช้ได้ = 14 วัน
